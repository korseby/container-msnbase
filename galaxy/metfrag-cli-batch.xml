<?xml version='1.0' encoding='UTF-8'?>
<tool id="metfrag-cli-batch" name="metfrag-cli-batch" version="0.4">
  <requirements>
    <container type="docker">korseby/mtbls709</container>
  </requirements>
  <description>Run MetFrag with a given parameter set.</description>
  <stdio>
    <regex match="" source="stderr" level="warning" description="R messages" />
    <exit_code range="1:" level="fatal" description="Tool error" />
  </stdio>
  <command><![CDATA[
    bash /usr/local/bin/run_metfrag.sh -p $metfrag_cli_batch_input_1 -f $metfrag_cli_batch_output_1 
    #if $metfrag_cli_batch_database_file != "None"
        -l "$metfrag_cli_batch_database_file"
    #end if
    #if $additionalparameters != "None"
        -a "$additionalparameters"
    #end if
    #if $additional_metfrag_scores != "None"
        -s "$additional_metfrag_scores"
    #end if
    ;
  ]]>
  </command>
  <inputs>
    <param name="metfrag_cli_batch_input_1" type="data" format="txt" optional="False" label="File with MetFrag parameters" help="File containing MetFrag parameters which is generated by msms2metfrag" />
    <param name="additionalparameters" type="text" value="" optional="True" label="Additional Parameters" help="Additional parameters that can be passed to MetFrag. This can include e.g. access information for a local MetChem database instance" />
    <param name="metfrag_cli_batch_database_file" type="data" format="csv" optional="True" label="Database File" help="File containing candidates used as database" />
    <param name="additional_metfrag_scores" type="select" display="checkboxes" multiple="true" label="Additional MetFrag scores" help="Add additional MetFrag scores used to score candidates">
      <option value="OfflineMetFusionScore">Spectral Similarity (MoNA) Scoring</option>
      <option value="StatisticalScore">Statistical Scoring</option>
    </param>
  </inputs>
  <outputs>
    <data name="metfrag_cli_batch_output_1" type="text" format="csv" label="MetFrag result file" />
  </outputs>
  <help>

.. class:: infomark

| **Tool update: See the 'NEWS' section at the bottom of the page**

---------------------------------------------------

.. class:: infomark

**Authors**

| **Payam Emami (payam.emami@medsci.uu.se)** and **Christoph Ruttkies (christoph.ruttkies@ipb-halle.de)** wrote and maintain this wrapper for MetFrag batch mode processing.

---------------------------------------------------

.. class:: infomark

**Please cite**

Ruttkies, C., Schymanski, E. L., Wolf, S., Hollender, J. and Neumann, S. MetFrag relaunched: incorporating strategies beyond in silico fragmentation. J Cheminform 8:3, (2016) DOI: 10.1186/s13321-016-0115-9

.. class:: infomark

**References**

| O. Tange (2011): GNU Parallel - The Command-Line Power Tool, ;login: The USENIX Magazine, February 2011:42-47.

---------------------------------------------------

=====================
MetFrag CLI Batch
=====================

-----------
Description
-----------

| This module is used to run MetFrag on annotated MS/MS spectra for compound annotation. The parameters are set by **msms2metfrag**.

+------------------+-----------------+
| predecessor tool | successor tool  |
+------------------+-----------------+
| msms2metfrag     | aggregatemetfrag|
+------------------+-----------------+

-----------
Input files
-----------

+------------------------------+------------+
| File                         |   Format   |
+==============================+============+
| 1)  File with MetFrag        |    txt     |
|     parameters               |            |
+------------------------------+------------+
| 2)  Database File (optional) |    csv     |
+------------------------------+------------+

----------
Parameters
----------

File with MetFrag parameters
        | File containing MetFrag parameters which is generated by **msms2metfrag**
        |

Additional Parameters
        | Additional parameters that can be passed to MetFrag. This can include e.g. access information for a local MetChem database instance
        |

Database File
	| File containing candidates used as database
	| 

Additional MetFrag scores
	| Add additional MetFrag scores used to score candidates
	|

------------
Output files
------------

metfrag_cli_batch_output_1
        | A csv output file with scored candidates and properties
        |

---------------------------------------------------

----
NEWS
----

CHANGES IN VERSION 0.4
========================

- added statistical scoring option

CHANGES IN VERSION 0.3
========================

- added support for additional MetFrag scores


CHANGES IN VERSION 0.2
========================

- added support for a local file database


CHANGES IN VERSION 0.1
========================

First version

  </help>
</tool>
